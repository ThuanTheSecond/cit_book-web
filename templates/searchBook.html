{% extends 'base.html' %}
{% load widget_tweaks %}
{% load filters %}

{% block bonusContent %}
<style>
    /* Empty state styling */
    .empty-state {
        min-height: 60vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 0;
    }
    
    .empty-state-container {
        background: white;
        padding: 3rem;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(25, 118, 210, 0.1);
        max-width: 600px;
        width: 90%;
        border: 1px solid rgba(25, 118, 210, 0.1);
        animation: fadeIn 0.6s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .btn-primary {
        background-color: #1976d2;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        color: white;
        text-decoration: none;
        display: inline-block;
    }
    
    .btn-primary:hover {
        background-color: #1565c0;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.15);
    }
    
    .mb-3 {
        margin-bottom: 1rem;
    }
    
    .mb-4 {
        margin-bottom: 1.5rem;
    }
    
    .py-5 {
        padding-top: 3rem;
        padding-bottom: 3rem;
    }
    
    .text-center {
        text-align: center;
    }
    
    .text-muted {
        color: #6c757d;
    }
</style>

<div class="body">
    <div class="overall container-fluid justify-content-center">
        <h3>Search Books</h3>
        <div class="filter">
            <span>Lọc theo: </span>
                <span><a href="{% url 'search' ftype=5 query=query search_type=search_type %}">Liên quan nhất</a> | </span>
                <span><a href="{% url 'search' ftype=1 query=query search_type=search_type %}">Lượt xem</a> | </span>
                <span><a href="{% url 'search' ftype=2 query=query search_type=search_type %}">Xuất bản gần đây</a> | </span>
                <span><a href="{% url 'search' ftype=3 query=query search_type=search_type %}">Đánh giá nhiều</a> | </span>
                <span><a href="{% url 'search' ftype=4 query=query search_type=search_type %}">Đánh giá tốt nhất</a></span> 
        </div>
    </div>
</div>
{% endblock bonusContent %}
    

{% block content %}
<div class="search-result">
    {% if page_obj %}
    <div class="search-book-content container-fluid justify-content-center">
        <ul id="book-form">
            {% comment %} thông tin sách {% endcomment %}
            {% for book in page_obj %}
                {% comment %} chỉnh sửa câu lệnh dưới để hiển thị từng cuốn sách {% endcomment %}
                {% comment %} Cần chỉnh sửa lại wishlist post {% endcomment %}
                <div class="book-found">
                    <li>
                        <div class="row">
                            <div class="left-content col-md-2 justify-content-center">
                                <a href="/book/detail/id={{book.book_id|add:'-3000'}}"><img class="book-image" src="{{ book.bookImage.url }}" alt="{{ book.book_title }}"></a>
                            </div>

                            <div class="middle-content col-md-7">
                                <a class="book-name" href="/book/detail/id={{book.book_id|add:'-3000'}}">{{ book.book_title }}</a> 
                                <p class="book-author">by {{book.book_author}}</p>
                                <p class="book-published">Xuất Bản: {{ book.book_publish }}</p>
                                
                                <div class="aveRating">
                                    <span class="product-rating">{{ averRates|get_item:book.book_id }}</span><span>/5 <span class="fa fa-star aveRating-start"></span> ({{ countRates|get_item:book.book_id }} - {{ book.book_view }} lượt xem)</span>
                                </div>
                            </div>

                            <div class="right-content col-md-3">
                                <div id='wishlist{{book.book_id}}' hx-post = "/wishCheck_post/"  hx-vals = '{"book_id": {{book.book_id}}}' hx-trigger="load" hx-target="#wishlist{{book.book_id}}">
                                    <button hx-post = "/wishList_post/" hx-vals = '{"book_id": {{book.book_id}}}' hx-trigger="click delay:0.25s">...</button>
                                </div>
                            </div>
                    </li><br>
                </div>
            {% endfor %}
        </ul>
    </div> 

    {% comment %} Đây là khi khong tim thay sach {% endcomment %}
    {% elif not page_obj%}
    {% comment %} Chỉnh sửa thông báo khi không tìm thấy sách {% endcomment %}
    <div class="empty-state text-center py-5">
        <div class="empty-state-container">
            <i class="fas fa-search mb-4" style="font-size: 4rem; color: #1a237e;"></i>
            <h3 class="mb-3" style="color: #1a237e;">Không tìm thấy sách</h3>
            <p class="text-muted mb-4" style="max-width: 500px; margin: 0 auto;">
                Không tìm thấy sách phù hợp với từ khóa "{{ query }}".
                Hãy thử tìm kiếm với từ khóa khác hoặc duyệt thư viện của chúng tôi.
            </p>
            <a href="/" class="btn btn-primary">
                <i class="fas fa-home"></i> Quay lại trang chủ
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock content %}
    

{% block navBot %}
    {% include 'pagePagnition.html' %}
{% endblock navBot %}

{% block scripts %}
<script src="https://unpkg.com/htmx.org@2.0.2/dist/htmx.js" integrity="sha384-yZq+5izaUBKcRgFbxgkRYwpHhHHCpp5nseXp0MEQ1A4MTWVMnqkmcuFez8x5qfxr"crossorigin="anonymous"></script>
{% endblock scripts %}